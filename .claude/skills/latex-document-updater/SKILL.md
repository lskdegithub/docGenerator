---
name: latex-document-updater
description: Batch update LaTeX documents including version numbers, dates, document IDs, project names, and tabular data. Supports find-and-replace operations with validation. Use when updating document metadata, refreshing data, or making bulk changes.
allowed-tools: Read, Write, Edit, Grep, Glob
---

# LaTeX Document Updater

批量更新 LaTeX 文档的元数据、版本号、日期和表格数据。

## 功能概述

该 Skill 用于批量更新 LaTeX 文档中的可变数据，包括：
- 文档标识号
- 系统标识
- 项目名称
- 软件版本号
- 文档版本号
- 日期信息
- 表格数据
- 责任人信息

## 更新类型

### 类型1：文档标识更新

**位置**: 1.1 标识

**更新内容**:
```latex
（1）文档标识号：xxxx；
（2）系统标识：xxxx，测试文档简称为xxxx；
（3）项目名称：xxxxxx；
（4）文档名称：xxxxxx节点软件测试大纲；
（5）软件版本号：xxxx版，软件版本标识采用三位编码规则，项目文档版本标识采用四位编码规则；
（6）本文档适用于：xxxxx系统项目。
```

**使用场景**:
- 初始化新文档
- 项目立项阶段
- 系统标识变更

### 类型2：版本号更新

**位置**: 文档多个位置

**更新内容**:
```latex
% 软件版本号
V0.7.1 → V0.7.2

% 文档版本号
2025-09-01 → 2025-10-01
```

**使用场景**:
- 软件版本升级
- 文档修订
- 定期更新

### 类型3：日期更新

**位置**: 文档封面、页脚、表格

**更新内容**:
```latex
% 表格中的日期
{\xiaowu 2025} → {\xiaowu 2026}

% 文档中的日期描述
2025年9月节点测试 → 2025年10月节点测试
```

**使用场景**:
- 节点周期更新
- 年度更新
- 修订日期更新

### 类型4：表格数据更新

**位置**: 各种表格

**更新内容**:
```latex
% 引用文档表
{\xiaowu 2025} → {\xiaowu 2026}

% 测试环境表
{\xiaowu V0.7.1} → {\xiaowu V0.7.2}
```

**使用场景**:
- 数据刷新
- 环境配置更新
- 测试项变更

### 类型5：责任人更新

**位置**: 表格、正文

**更新内容**:
```latex
{\xiaowu 张三} → {\xiaowu 李四}
```

**使用场景**:
- 人员变更
- 角色调整

## 批量更新方法

### 方法1：全局替换

**工具**: Edit 工具的 `replace_all` 参数

**示例**:
```latex
# 将所有 "xxxx" 替换为 "项目A"
xxxx → 项目A
```

**注意**:
- 确保替换词唯一
- 避免误替换
- 替换后需验证

### 方法2：精确替换

**工具**: Edit 工具，指定上下文

**示例**:
```latex
# 只替换文档标识号中的 xxxx
（1）文档标识号：xxxx；
↓
（1）文档标识号：DOC-2025-001；
```

**优点**:
- 精确控制
- 避免误替换
- 可追溯

### 方法3：条件替换

**工具**: Grep + 手动验证

**步骤**:
1. 使用 Grep 查找所有匹配项
2. 人工确认每项是否需要替换
3. 逐个替换或批量替换

**示例**:
```bash
# 查找所有版本号
grep -n "V0\\.7\\." str-captain-1.tex

# 输出：
# 100:    （5）软件版本号：V0.7.1版，软件版本标识采用三位编码规则，项目文档版本标识采用四位编码规则；
# 172:    {\xiaowu V0.7.1}
```

### 方法4：表格数据替换

**工具**: Edit 工具，精确到表格单元格

**示例**:
```latex
% 更新表格中的版本号
\multicolumn{1}{|c|}{{\xiaowu 2}} &
{\xiaowu xxxxxxxx系统} &
{\xiaowu V0.7.1} &  ← 这里
{\xiaowu 被测软件} &
{\xiaowu xxxxx} &
{\xiaowu } \\
```

## 使用方法

### 场景1：初始化新文档

**用户请求**: "帮我初始化文档，填写项目信息"

**执行步骤**:

1. **准备项目信息**
   - 文档标识号：DOC-2025-001
   - 系统标识：SYS-001
   - 项目名称：XXXXXXXX系统
   - 软件版本号：V0.7.1
   - 文档名称：9月节点软件测试大纲

2. **逐项替换**
   - 替换 1.1 节中的标识信息
   - 更新文档标题
   - 更新表格中的占位符

3. **验证**
   - 编译文档
   - 检查遗漏的 xxxx
   - 确认格式正确

4. **输出报告**
   ```
   更新完成：
   - 替换文档标识号：1处
   - 替换系统标识：2处
   - 替换项目名称：5处
   - 替换软件版本号：3处
   ```

### 场景2：版本升级更新

**用户请求**: "软件升级到 V0.7.2，更新所有相关位置"

**执行步骤**:

1. **查找所有版本号**
   ```bash
   grep -n "V0\\.7\\.1" str-captain-1.tex
   ```

2. **批量替换**
   - 使用 Edit 工具的 `replace_all`
   - 将 V0.7.1 替换为 V0.7.2

3. **验证**
   - 检查所有版本号已更新
   - 确认没有遗漏

### 场景3：日期更新

**用户请求**: "将所有 2025 年的日期更新为 2026 年"

**执行步骤**:

1. **查找所有日期**
   ```bash
   grep -n "2025" str-captain-1.tex
   ```

2. **分析日期类型**
   - 表格中的日期
   - 正文中的日期
   - 版本号中的日期

3. **选择性替换**
   - 只替换年份：2025 → 2026
   - 保留版本号中的日期（如果有）

4. **验证**
   - 检查所有日期已更新
   - 确认格式一致

### 场景4：表格数据刷新

**用户请求**: "更新表2引用文档中的日期"

**执行步骤**:

1. **定位表格**
   - 查找 "表 2 引用文档一览表"

2. **提取表格内容**
   - 读取表格行
   - 识别日期列

3. **更新日期**
   - 更新 "日期" 列中的年份
   - 保持其他内容不变

4. **验证**
   - 编译检查
   - 确认表格格式正确

### 场景5：批量替换占位符

**用户请求**: "将所有 'xxxx' 替换为实际内容"

**执行步骤**:

1. **统计占位符**
   ```bash
   grep -o "xxxx" str-captain-1.tex | wc -l
   ```

2. **分类占位符**
   - 文档标识号：xxxx
   - 系统名称：xxxxx
   - 其他占位符

3. **逐类替换**
   - 先替换最具体的（如文档标识号）
   - 再替换通用的
   - 最后处理剩余的

4. **最终检查**
   - 查找剩余的 xxxx
   - 确认所有占位符已处理

## 更新验证清单

更新完成后，执行以下检查：

- [ ] 所有版本号已更新且一致
- [ ] 所有日期已更新
- [ ] 文档标识信息完整
- [ ] 表格数据正确
- [ ] 没有遗漏的占位符（xxxx）
- [ ] 特殊字符已正确转义
- [ ] 文档可正常编译
- [ ] PDF 输出格式正确
- [ ] 编号连续且唯一
- [ ] 交叉引用正确

## 批量更新脚本

创建批量更新脚本：

```bash
#!/bin/bash
# update-document.sh

FILE="src/doc2tex-template/str-captain-1.tex"

echo "开始批量更新文档..."

# 1. 更新版本号
echo "更新版本号..."
sed -i 's/V0\.7\.1/V0.7.2/g' "$FILE"

# 2. 更新年份
echo "更新年份..."
sed -i 's/2025/2026/g' "$FILE"

# 3. 更新项目名称
echo "更新项目名称..."
sed -i 's/xxxxxx/新项目名称/g' "$FILE"

echo "更新完成！"
echo "请检查以下内容："
echo "1. 版本号是否全部更新"
echo "2. 日期是否正确"
echo "3. 占位符是否已全部替换"
```

使用示例：
```bash
chmod +x update-document.sh
./update-document.sh
```

## 注意事项

1. **备份原文件**
   - 更新前务必备份
   - 保留原始版本
   - 使用 git 版本控制

2. **替换顺序**
   - 先替换最具体的
   - 再替换通用的
   - 避免冲突

3. **验证重要**
   - 每次更新后编译
   - 检查格式正确性
   - 对比原始文档

4. **保留日志**
   - 记录更新内容
   - 标注更新时间
   - 记录更新原因

5. **交叉引用**
   - 更新编号后检查引用
   - 确保表格编号连续
   - 验证章节引用正确

## 调试技巧

### 替换不生效

**原因**:
- 特殊字符未转义
- 空格或换行符不匹配
- 大小写不匹配

**解决方法**:
- 检查精确的字符串
- 使用正则表达式
- 转义特殊字符

### 替换过多

**原因**:
- 搜索词过于宽泛
- 替换了不该替换的内容

**解决方法**:
- 使用更精确的搜索词
- 提供更多上下文
- 逐个手动确认

### 编译失败

**原因**:
- 替换破坏了 LaTeX 语法
- 特殊字符未转义

**解决方法**:
- 检查 `{}` 配对
- 转义特殊字符
- 验证表格结构

### 格式错误

**原因**:
- 替换时丢失了格式命令
- 字体命令不匹配

**解决方法**:
- 对比原始格式
- 复制粘贴格式命令
- 使用精确替换

## 示例对话

**用户**: "帮我将文档中的版本号从 V0.7.1 更新到 V0.7.2"

**执行流程**:
1. 查找所有 V0.7.1
2. 确认位置和数量
3. 批量替换为 V0.7.2
4. 编译验证
5. 返回更新报告

**用户**: "更新所有 2025 年的日期为 2026 年"

**执行流程**:
1. 搜索所有 2025
2. 分析日期类型
3. 选择性替换（保留版本号中的日期）
4. 编译验证
5. 提供更新统计

**用户**: "初始化文档，填写项目信息"

**执行流程**:
1. 询问项目详细信息
2. 准备替换映射表
3. 逐项替换占位符
4. 验证完整性
5. 编译生成 PDF
6. 提供更新清单

**用户**: "批量更新表格中的数据"

**执行流程**:
1. 定位所有表格
2. 识别需要更新的列
3. 批量更新数据
4. 验证表格格式
5. 检查数据一致性
6. 编译验证
