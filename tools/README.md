# 工具脚本说明

本目录包含用于LaTeX文档生成的辅助工具。

## 📁 目录结构

```
tools/
├── README.md                      # 本文件
├── README_LEVELS.md               # 层级支持详细说明
├── extract_word_structure.py      # Word文档章节结构提取工具（快速）
├── analyze_docx_structure.py      # Word文档层级分析工具（详细）
├── analyze_docx_structure_full.py # Word文档完整层级分析（支持1-7级，推荐）
├── extract_docx.py                # DOCX文档解析工具
└── extract_structure.py           # Word文档结构提取工具（早期版本）
```

## 🔧 工具说明

### 1. analyze_docx_structure_full.py 🌟 最强

**用途**：完整分析Word文档的标题层级结构，支持1-7级标题，自动生成LaTeX代码

**特点**：
- ✅ 支持任意深度层级（1-7级）
- ✅ 根据ilvl（编号级别）准确推断层级
- ✅ 自动生成带编号的LaTeX代码
- ✅ 识别所有标题样式
- ✅ 提供层级统计信息
- ✅ 超过5级时给出自定义命令建议
- ✅ 生成Markdown格式预览

**使用方法**：
```bash
# 从项目根目录执行
python3 tools/analyze_docx_structure_full.py templates/document.docx

# 示例
python3 tools/analyze_docx_structure_full.py templates/9月节点-测试大纲-0928.docx
```

**输出示例**：
```
========================================================================================================================
Word文档标题结构详细分析（支持1-6级）
========================================================================================================================
样式         编号ID       ilvl     推断层级       LaTeX命令              文本内容
------------------------------------------------------------------------------------------------------------------------
1级                    -        1          \section*            范围
2级                    -        2          \subsection*         标识
2级         11         1        2          \subsection*         测试现场
2级         11         2        3          \subsubsection*      软件项
3级         16         3        4          \paragraph*          xxxxx功能测试

发现的最大层级深度: 4级

========================================================================================================================
LaTeX代码建议（带层级编号）
========================================================================================================================
\section*{1. 范围}
\subsection*{1.1 标识}
\subsection*{3.1 测试现场}
\subsubsection*{3.2.1 软件项}
\paragraph*{4.2.1.1 xxxxx功能测试}
```

**层级映射规则**：
- ilvl=0 → 1级（`\section*`）
- ilvl=1 → 2级（`\subsection*`）
- ilvl=2 → 3级（`\subsubsection*`）
- ilvl=3 → 4级（`\paragraph*`）
- ilvl=4 → 5级（`\subparagraph*`）
- ilvl=5 → 6级（需自定义）
- ilvl≥6 → 7级+（需自定义）

**适用场景**：
- 包含深层级结构的复杂文档
- 需要自动生成编号的文档
- 不确定文档层级深度的分析

---

### 2. extract_word_structure.py ⭐ 快速

**用途**：从Word文档中准确提取章节层级结构

**特点**：
- ✅ 直接解析Word文档XML结构
- ✅ 避免pandoc转换导致的编号错乱问题
- ✅ 自动识别1级、2级、3级标题
- ✅ 生成LaTeX结构建议

**使用方法**：
```bash
# 从项目根目录执行
python3 tools/extract_word_structure.py templates/document.docx

# 示例
python3 tools/extract_word_structure.py templates/9月节点-测试大纲-0928.docx
```

**输出示例**：
```
================================================================================
Word文档章节结构
================================================================================
[L1] [198] 3. 软件测试环境
  [L2] [43] 3.1 测试现场
  [L2] [43] 3.2 测试环境概述
  [L2] [44] 3.2.1 软件项

================================================================================
LaTeX结构建议
================================================================================
\section*{3. 软件测试环境}
\subsection*{3.1 测试现场}
\subsection*{3.2 测试环境概述}
\subsubsection*{3.2.1 软件项}
```

**样式代码对照**：
- 样式198 = 1级标题（L1）
- 样式43 = 2级标题（L2）
- 样式44 = 2级标题（L2）
- 样式46 = 3级标题（L3）
- 样式215 = 表格内容（忽略）

### 2. extract_docx.py

**用途**：提取Word文档的所有段落文本和样式

**特点**：
- 解析Word文档的XML内容
- 显示所有段落和样式代码
- 适合调试和分析

**使用方法**：
```bash
python3 tools/extract_docx.py
```

### 3. extract_structure.py

**用途**：早期版本的Word文档结构提取工具

**说明**：此工具已被 `extract_word_structure.py` 替代，保留仅供参考。

## 💡 使用建议

### 工作流程

1. **分析Word文档结构**
   ```bash
   # 对于简单文档（1-3级）
   python3 tools/extract_word_structure.py templates/your-document.docx

   # 对于复杂文档（1-7级，推荐）
   python3 tools/analyze_docx_structure_full.py templates/your-document.docx
   ```

2. **根据输出创建LaTeX章节**
   - 使用 `latex-chapter-creator` skill
   - 按照输出的层级结构创建
   - 注意使用正确的层级编号（如4.1.1而非4.2）

3. **处理深层级标题（如有）**
   - 1-5级：LaTeX原生支持，直接使用
   - 6级+：在导言区添加自定义命令（见输出提示）

4. **生成和编译文档**
   ```bash
   ./build.sh
   ```

### 工具选择指南

| 文档特征 | 推荐工具 | 理由 |
|----------|----------|------|
| 简单文档（1-3级） | `extract_word_structure.py` | 快速简洁 |
| 中等文档（1-4级） | `analyze_docx_structure.py` | 详细分析 |
| 复杂文档（1-7级） | `analyze_docx_structure_full.py` | **完整支持** |
| 不确定深度 | `analyze_docx_structure_full.py` | 自动适配 |

### 注意事项

- ⚠️ **不要使用pandoc直接转换**：会导致章节编号错乱
- ✅ **使用XML解析方法**：可以准确获取章节层级
- ⚠️ **注意层级编号规则**：三级标题应继承父级编号（如4.1.1）
- ⚠️ **样式215是表格内容**：不要当作章节标题
- ⚠️ **深层级文档**：超过5级时，脚本会给出自定义命令建议

## 📝 开发说明

### 添加新工具

1. 将工具脚本放入 `tools/` 目录
2. 在本文件中添加说明
3. 确保脚本有可执行权限：`chmod +x tools/scriptname.py`
4. 更新主目录的README.md（如需要）

### 脚本编写规范

- Python脚本需要包含 shebang：`#!/usr/bin/env python3`
- 添加使用说明和示例
- 提供清晰的错误提示
- 支持命令行参数
